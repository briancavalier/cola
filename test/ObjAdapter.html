<!DOCTYPE HTML>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<title>ObjAdapter test</title>

<script src="util/doh/runner.js"></script>
<script src="test-config.js"></script>

<script type="text/javascript">
require(['cola/ObjAdapter', 'domReady!'], function(ObjAdapter) {

	doh.register('the basics', [
		function setBindings (doh) {
			var bindings = {}, adaptedObject;
			adaptedObject = new ObjAdapter({});
			adaptedObject.setBindings(bindings);
			doh.assertEqual(bindings, adaptedObject._bindings);
		},
		function canHandle (doh) {
			doh.assertFalse(ObjAdapter.canHandle(), 'undefined');
			doh.assertFalse(ObjAdapter.canHandle(null), 'null');
			doh.assertFalse(ObjAdapter.canHandle(function(){}), 'function');
			doh.assertTrue(ObjAdapter.canHandle([]), 'array');
			doh.assertTrue(ObjAdapter.canHandle({}), 'object');
			doh.assertTrue(ObjAdapter.canHandle(document.body), 'DOMNode');
		}
	]);
	doh.register('events', [
		function watch (doh) {
			var obj, adapted, dfd;
			obj = { first: 'Fred', last: 'Fintstone' };
			adapted = new ObjAdapter(obj);
			dfd = new doh.Deferred();
			adapted.watch('first', function (name, value) {
				dfd.callback(value == 'Martha' && name == 'first');
			});
			adapted.propUpdated('first', 'Martha');
			return dfd;
		},
		function propUpdated (doh) {
			var obj, adapted, dfd;
			obj = { first: 'Fred', last: 'Flintstone' };
			adapted = new ObjAdapter(obj);
			dfd = new doh.Deferred();
			adapted.watchAll(function (name, value) {
				dfd.callback(value == 'Astaire' && name == 'last');
			});
			adapted.propUpdated('last','Astaire');
			return dfd;
		}
	]);

	doh.run();

});
</script>
</head>
<body>
</body>
</html>